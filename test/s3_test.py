import pytest

from backend.services.s3 import S3
from backend.config.s3config import s3config
from base64 import b64decode
import requests


def test_upload_file():
    s3 = S3(s3config.buckets.upload_bucket,
            s3config.REGION_NAME, s3config.limits_file_size)

    imgdata = "data:image/jpeg;base64,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"

    response = s3.upload(imgdata, "TESTE.jpeg", "test/")

    print(response)
    assert True == True

def test_create_presigned_url():
    s3 = S3(s3config.buckets.upload_bucket, s3config.REGION_NAME, s3config.limits_file_size)
        
    response = s3.create_presigned_url("testeUrl/", "test.jpg")

    print(response)
    object_name = "c:/Users/saymo/Desktop/pastas/backend-estagio/backend-estagio/test/fixtures/test.jpg"
    with open(object_name, "rb") as f:
        files = {"file": (response["fields"]["key"], f)}
        http_response = requests.post(response['url'], data=response["fields"], files=files)
        print(http_response.text)
